<!DOCTYPE html>
<html>

<head>
    <title>Spreadsheet Sample</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" href="assets/favicon.png"/>
    <link rel="apple-touch-icon" href="assets/favicon.png"/>
</head>

<body>
    <!-- ------------------------header----------------------------- -->

    <div class="grid-container" id="header">

        <button type="button" id="sheetButton" onclick="location.href='iframe.html' ">Spread sheet</button>
        <h3 id="titleButton">For your second neuroplasticity</h3>
        <button type="button" id="sheetEditButton" onclick="location.href='about.html'">About</button>

    </div>

    <!-- ---------------------grid container------------------------- -->    
    <div class="grid-container" id="spreadsheet-data"></div>


    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
    <script type="text/javascript">
        var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR6PkEOhOqvoJ7UXiwuvq4GGR8H_Lf3uNIqKREi3euyoUhROcc6CSH0Q7UN8YXBdiTt_D3o9fTWu3T5/pub?output=csv';

        function init() {
            Papa.parse(public_spreadsheet_url, {
                download: true,
                header: true,
                complete: showInfo
            })
        }

        window.addEventListener('DOMContentLoaded', init)

        function showInfo(results) {
            var data = results.data
            var dataLength = data.length
            //console.log(data);

            for (var i = 0; i < dataLength; i++) {
                document.getElementById("spreadsheet-data").innerHTML += "<div class='grid-item" + (parseFloat(i) + 1) + "' id=" + "component-" +  (parseFloat(i) + 1) + ">" + "<div class = 'memo' a href='#'><h1>" + data[i].title + "</h1>" + "<p>" + data[i].text + "</p>" + "<p id='date'>" + data[i].date + "</p></div><div class='belonging'><p class='thoughts'>"  + data[i].thoughts + "</p></div><div class ='number-button'><p class='number'>" + data[i].number + "</p></div></div>"
            }

            var activeComponent = null; // Variable to store the active component

            for (var i = 0; i < dataLength; i++) {
                const el = document.getElementById(`component-${i+1}`);
                const memoEl = el.querySelector('.memo');
                const thoughtsEl = el.querySelector('.thoughts');
                thoughtsEl.style.display = "none";
                

                const connection = data[i].connection;
                const connectionArray = connection.split(',') || [];

                // store all memos and thoughts
                const allMemos = Array.from(document.querySelectorAll('.memo'));
                const allThoughts = Array.from(document.querySelectorAll('.thoughts'));

                function onClick(event) {

                        // reset all the selected elements
                        allMemos.forEach(node => {
                            node.classList.remove('myclickmain');
                            node.classList.remove('myclick');
                        });

                        allThoughts.forEach(node => {
                            node.style.display = "none";
                        });
                

                        activeComponent = this;

                        memoEl.classList.add('myclickmain');
                        thoughtsEl.style.display = "block";
                        
                        
                    
                        
                        const relatedComponents = connectionArray.map(function (id) {
                            return document.getElementById(`component-${id}`);
                        });

                        relatedComponents.forEach(function (component) {
                            const relatedMemoComponent = component.querySelector('.memo');
                            const relatedThoughtsComponent = component.querySelector('.thoughts');
                            relatedMemoComponent.classList.add('myclick');
                            relatedThoughtsComponent.style.display = "block";
                        });   

                    } 

                    memoEl.addEventListener("click", onClick);
                    }
                    
                  
                }
                
    </script>

    <script type="text/javascript">

    </script>
</body>

</html>
